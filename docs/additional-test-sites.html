<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Additional test sites | Analyses of peatland carbon stocks</title>
<meta name="author" content="Marte Fandre, Anders L. Kolstad">
<meta name="description" content="We used two contrasting sites, Tydal and Geilo, for the main analyses and testing. Now I will bring in an additional four sites to validate the generality of these finding.  7.1 Modalen Import...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 7 Additional test sites | Analyses of peatland carbon stocks">
<meta property="og:type" content="book">
<meta property="og:description" content="We used two contrasting sites, Tydal and Geilo, for the main analyses and testing. Now I will bring in an additional four sites to validate the generality of these finding.  7.1 Modalen Import...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Additional test sites | Analyses of peatland carbon stocks">
<meta name="twitter:description" content="We used two contrasting sites, Tydal and Geilo, for the main analyses and testing. Now I will bring in an additional four sites to validate the generality of these finding.  7.1 Modalen Import...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analyses of peatland carbon stocks</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Analyses of peatland carbon stocks</a></li>
<li><a class="" href="data.html"><span class="header-section-number">2</span> Data</a></li>
<li><a class="" href="find-best-model.html"><span class="header-section-number">3</span> Find best model</a></li>
<li><a class="" href="optimise-sampling-intensity.html"><span class="header-section-number">4</span> Optimise sampling intensity</a></li>
<li><a class="" href="validate-using-reduced-sampling-data.html"><span class="header-section-number">5</span> Validate using reduced sampling data</a></li>
<li><a class="" href="carbon-stocks.html"><span class="header-section-number">6</span> Carbon stocks</a></li>
<li><a class="active" href="additional-test-sites.html"><span class="header-section-number">7</span> Additional test sites</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">8</span> Session Info</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/anders-kolstad/carbonCalculator">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="additional-test-sites" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Additional test sites<a class="anchor" aria-label="anchor" href="#additional-test-sites"><i class="fas fa-link"></i></a>
</h1>
<p>We used two contrasting sites, Tydal and Geilo, for the main analyses and testing. Now I will bring in an additional four sites to validate the generality of these finding.</p>
<div id="modalen" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Modalen<a class="anchor" aria-label="anchor" href="#modalen"><i class="fas fa-link"></i></a>
</h2>
<p>Import shape files with peatland delineations.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_modalen</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"Data/Modalen/Modalen_myrareal.shp"</span><span class="op">)</span>
<span class="co">#st_crs(SHP_modalen) #OK</span></code></pre></div>
<p>Another shape file with the project area (see below)</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_modalen_project</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"Data/Modalen/modalen_shp.shp"</span><span class="op">)</span> 
<span class="co">#st_crs(SHP_modalen_project) # OK</span></code></pre></div>
<p>Import depth samples</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_modalen</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"Data/Modalen/modalen_punkter.shp"</span><span class="op">)</span>
<span class="co">#st_crs(depths_modalen) #OK</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_modalen</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span>,
             shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_modalen_project</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-86"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-86-1.png" alt="The Modalen test site sith peatland delineated as grey polygons. Crosses are peat depth samples, contained with in the project area (dotted line)." width="672"><p class="caption">
Figure 7.1: The Modalen test site sith peatland delineated as grey polygons. Crosses are peat depth samples, contained with in the project area (dotted line).
</p>
</div>
<p>The peatland delineation (five peatland insde the project area) is mapped using aerial photos and other base maps. There may be peat also between these polygions, however, there si for sure areas between the polygons that are not peat. The depth measurements are performed systematically inside the project area. I don’t think we should include points that are taken from smaller isolated mire fragments that are clearly separated from the main peatlands. This example illustrates the importance of appropriate sampling. We are now limited to just a few data points. The smaller mires have only one or two datapoints.</p>
<p>Calculating the combined area of the five mires.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_modalen</span><span class="op">$</span><span class="va">myArea</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">$</span><span class="va">myArea</span><span class="op">)</span>
<span class="co">#&gt; 16752.75 [m^2]</span></code></pre></div>
<p>And the area of the project delineation</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_modalen_project</span><span class="op">$</span><span class="va">myArea</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">SHP_modalen_project</span><span class="op">)</span>
<span class="va">SHP_modalen_project</span><span class="op">$</span><span class="va">myArea</span>
<span class="co">#&gt; 36179.43 [m^2]</span></code></pre></div>
<p>Removing the depth measurement from outside the peatland delinitaion</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_modalen_reduced</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span><span class="va">depths_modalen</span>, <span class="va">SHP_modalen</span><span class="op">)</span>
<span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span>
<span class="co">#&gt; constant throughout all geometries</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span>,
             shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_modalen_project</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-90"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-90-1.png" alt="The Modalen test site sith peatland delineated as grey polygons. Crosses are peat depth samples, contained with in the project area (dotted line). Only depth measurements that intersects the mire polygons are included" width="672"><p class="caption">
Figure 7.2: The Modalen test site sith peatland delineated as grey polygons. Crosses are peat depth samples, contained with in the project area (dotted line). Only depth measurements that intersects the mire polygons are included
</p>
</div>
<p>Create a raster grid</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#First fix polygon closure</span>
<span class="va">SHP_modalen</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">)</span>


<span class="va">grid_Modalen_stars_crop</span> <span class="op">&lt;-</span> <span class="fu">starsExtra</span><span class="fu">::</span><span class="fu"><a href="https://michaeldorman.github.io/starsExtra/reference/make_grid.html">make_grid</a></span><span class="op">(</span><span class="va">SHP_modalen</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">grid_Modalen_stars_crop</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-92"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-92-1.png" alt="Checking that the raster grid for Modalen looks correct." width="672"><p class="caption">
Figure 7.3: Checking that the raster grid for Modalen looks correct.
</p>
</div>
<p>Predict peat depth</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_optimumPower</span><span class="op">(</span>nmax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span>,
                   peatDepths <span class="op">=</span> <span class="va">depths_modalen_reduced</span>,
                   title<span class="op">=</span><span class="st">"Modalen"</span>,
                   peatlandDelimination <span class="op">=</span> <span class="va">SHP_modalen</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="inline-figure"><img src="carbonCalculator_files/figure-html/unnamed-chunk-93-1.png" width="672"></div>
<p>Unsurprising, when we have so few data points, the optimum power is very low. I will predict using power 1 through 3 to compare, just because I don’t trust power 1 is the best choice.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IDW_Modalen_1</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, 
           locations <span class="op">=</span> <span class="va">depths_modalen_reduced</span>, 
           newdata <span class="op">=</span> <span class="va">grid_Modalen_stars_crop</span>, 
           idp<span class="op">=</span><span class="fl">1</span>,
           nmax <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="co"># nmax &gt; than the number of points</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>

<span class="va">IDW_Modalen_2</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, 
           locations <span class="op">=</span> <span class="va">depths_modalen_reduced</span>, 
           newdata <span class="op">=</span> <span class="va">grid_Modalen_stars_crop</span>, 
           idp<span class="op">=</span><span class="fl">2</span>,
           nmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>

<span class="va">IDW_Modalen_3</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, 
           locations <span class="op">=</span> <span class="va">depths_modalen_reduced</span>, 
           newdata <span class="op">=</span> <span class="va">grid_Modalen_stars_crop</span>, 
           idp<span class="op">=</span><span class="fl">3</span>,
           nmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_Modalen_1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 1\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
,
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_Modalen_2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 2\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
,
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_Modalen_3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 3\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="op">)</span>
<span class="co">#&gt; Legend labels were too wide. The labels have been resized to 0.46, 0.46, 0.46, 0.46, 0.46, 0.46. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</span>
<span class="co">#&gt; Legend labels were too wide. The labels have been resized to 0.46, 0.46, 0.46, 0.46, 0.46, 0.46. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</span>
<span class="co">#&gt; Legend labels were too wide. The labels have been resized to 0.46, 0.46, 0.46, 0.46, 0.46, 0.46. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-95"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-95-1.png" alt="IDW for peat depth at Modalen test site." width="672"><p class="caption">
Figure 7.4: IDW for peat depth at Modalen test site.
</p>
</div>
<p>I think power 3 looks more accurate because of the way it gives weight to local points. The recommended practice for this case I think would be to analyse each polyong or mire separately because of how the point from neighboring mires affect the depth predictions.</p>
<p>Summary stats for the peat depth at Modalen.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   0.000   0.400   0.600   1.017   1.475   2.800</span></code></pre></div>
<p>The MAE for the power =3 prediction is 0.82 m.</p>
<p>The rough volume (in m3), that is the mean peat depth multiplied by the area, is</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">depths_modalen_reduced</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">$</span><span class="va">myArea</span><span class="op">)</span>
<span class="co">#&gt; 17031.97 [m^2]</span></code></pre></div>
<p>Number of depth samples per 100 m2:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">12</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SHP_modalen</span><span class="op">$</span><span class="va">myArea</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; 0.07163001 [1/m^2]</span></code></pre></div>
<p>Interpolated volume</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">volume_modalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">IDW_Modalen_3</span><span class="op">$</span><span class="va">var1.pred</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 16792.6</span></code></pre></div>
<p>Estimated carbon stocks for the Modalen site:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_cStocks</span><span class="op">(</span><span class="va">volume_modalen</span>, peatData <span class="op">=</span> <span class="va">df</span><span class="op">)</span>
<span class="co">#&gt;        5%       50%       95%      mean        sd </span>
<span class="co">#&gt; 659.49512 760.21290 880.30501 764.35245  66.95905</span></code></pre></div>
</div>
<div id="opelandsmarka" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Opelandsmarka<a class="anchor" aria-label="anchor" href="#opelandsmarka"><i class="fas fa-link"></i></a>
</h2>
<p>Import shape file</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_opelandsmarka</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"Data/Opelandsmarka/Opelandsmarka Voss.shp"</span><span class="op">)</span>
<span class="co">#st_crs(SHP_opedalsmarka) #32632 UTM 32</span></code></pre></div>
<p>The depth measurements are in three different files.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_opelandsmarka1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Data/Opelandsmarka/Torvdybder_Opelandsmarka_myr1.csv"</span>, 
    delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"ISO-8859-1"</span><span class="op">)</span>, 
    trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">depths_opelandsmarka2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Data/Opelandsmarka/Torvdybder_Opelandsmarka_myr2.csv"</span>, 
    delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"ISO-8859-1"</span><span class="op">)</span>, 
    trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">depths_opelandsmarka3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Data/Opelandsmarka/Torvdybder_Opelandsmarka_myr3.csv"</span>, 
    delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"ISO-8859-1"</span><span class="op">)</span>, 
    trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># The last one is missing a column</span>

<span class="va">depths_opelandsmarka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">depths_opelandsmarka1</span>,
                                  <span class="va">depths_opelandsmarka2</span>,
                                  <span class="va">depths_opelandsmarka3</span><span class="op">)</span>


<span class="va">depths_opelandsmarka</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span>,
                                     coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UTM_N_ZONE32N"</span>, <span class="st">"UTM_E_ZONE32N"</span><span class="op">)</span>,
                                     crs <span class="op">=</span> <span class="fl">32632</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span>,
             shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-102"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-102-1.png" alt="Test site: Opelandsmarka. Crosses are peat depth measurements." width="672"><p class="caption">
Figure 7.5: Test site: Opelandsmarka. Crosses are peat depth measurements.
</p>
</div>
<p>I think we can ignore that top mire as it was not sampled nearly as intensive as the other two.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_opelandsmarka_twoMires</span> <span class="op">&lt;-</span> <span class="va">SHP_opelandsmarka</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span></code></pre></div>
<p>It could be a good idea sometimes to include depth measurements outside the mire polygons (with a depth of 0). Here it is easier for me to just exclude all points outide any polygon.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_opelandsmarka</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span>, <span class="va">SHP_opelandsmarka_twoMires</span><span class="op">)</span>
<span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span>
<span class="co">#&gt; constant throughout all geometries</span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span>,
             shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-105"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-105-1.png" alt="Opelandsmarka with two out of three mires. Crosses are peat depth measurements." width="672"><p class="caption">
Figure 7.6: Opelandsmarka with two out of three mires. Crosses are peat depth measurements.
</p>
</div>
<p>There is one NA in the depth data which we have to remove</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_opelandsmarka</span> <span class="op">&lt;-</span> <span class="va">depths_opelandsmarka</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<p>Try again:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_optimumPower</span><span class="op">(</span>peatDepths <span class="op">=</span> <span class="va">depths_opelandsmarka</span>, 
                   title <span class="op">=</span> <span class="st">"Opelandsmarka"</span>,
                   peatlandDelimination <span class="op">=</span> <span class="va">SHP_opelandsmarka_twoMires</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-107"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-107-1.png" alt="Determening the optimal power for the Opelandsmarka test site." width="672"><p class="caption">
Figure 7.7: Determening the optimal power for the Opelandsmarka test site.
</p>
</div>
<p>Again the lowest MAE is obtained from a power of 1, but as we have seen, the power should probably be set higher. The predicted peat volume for example is quite unstable at low power settings.</p>
<p>Create a raster grid for the predictions</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_Opelandsmarka_stars_crop</span> <span class="op">&lt;-</span> <span class="fu">starsExtra</span><span class="fu">::</span><span class="fu"><a href="https://michaeldorman.github.io/starsExtra/reference/make_grid.html">make_grid</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">)</span></code></pre></div>
<p>The depths are recorded as cm not meters. Converting to m.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_opelandsmarka</span><span class="op">$</span><span class="va">Dybde</span> <span class="op">&lt;-</span> <span class="va">depths_opelandsmarka</span><span class="op">$</span><span class="va">Dybde</span><span class="op">/</span><span class="fl">100</span></code></pre></div>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IDW_opelandsmarka_1</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">depths_opelandsmarka</span>, 
                    newdata<span class="op">=</span><span class="va">grid_Opelandsmarka_stars_crop</span>, 
                    nmax<span class="op">=</span><span class="va">nmax</span>, 
                    idp<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>

<span class="va">IDW_opelandsmarka_2</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">depths_opelandsmarka</span>, 
                    newdata<span class="op">=</span><span class="va">grid_Opelandsmarka_stars_crop</span>, 
                    nmax<span class="op">=</span><span class="va">nmax</span>, 
                    idp<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>

<span class="va">IDW_opelandsmarka_3</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">depths_opelandsmarka</span>, 
                    newdata<span class="op">=</span><span class="va">grid_Opelandsmarka_stars_crop</span>, 
                    nmax<span class="op">=</span><span class="va">nmax</span>, 
                    idp<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myBreaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.5</span><span class="op">)</span>
<span class="va">myPos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_opelandsmarka_1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 1\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="va">myBreaks</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="va">myPos</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">myPos</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
,
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_opelandsmarka_2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 2\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="va">myBreaks</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="va">myPos</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">myPos</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
,
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_opelandsmarka_3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 3\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="va">myBreaks</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="va">myPos</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">myPos</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
ncol <span class="op">=</span> <span class="fl">2</span>

<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="carbonCalculator_files/figure-html/unnamed-chunk-111-1.png" width="672"></div>
<p>With power set to 1 the model is too flat, and the deep areas are not identified correctly. Power 2 or 3 makes less of a difference. Becaus ethe MAE and volume estimates are so similar, I will chose the modet local model (power = 3)</p>
<p>Getting the total peatland area</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">$</span><span class="va">myArea</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">$</span><span class="va">myArea</span><span class="op">)</span>
<span class="co">#&gt; 8700.213 [m^2]</span></code></pre></div>
<p>Getting the mean peat depth (after excluding points outside the polygons)</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span>
<span class="co">#&gt; [1] 1.058333</span></code></pre></div>
<p>Rough volume</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">$</span><span class="va">myArea</span><span class="op">)</span>
<span class="co">#&gt; 9207.725 [m^2]</span></code></pre></div>
<p>Number of peat depth measurements</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span>
<span class="co">#&gt; [1] 54</span></code></pre></div>
<p>Depth measurement density (points per 100 m-2)</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_opelandsmarka</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">SHP_opelandsmarka_twoMires</span><span class="op">$</span><span class="va">myArea</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; 0.6206745 [1/m^2]</span></code></pre></div>
<p>Interpolated peat volume (best model)</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">vol_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">IDW_opelandsmarka_3</span><span class="op">$</span><span class="va">var1.pred</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 9270.232</span></code></pre></div>
<p>Estimated C stocks</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_cStocks</span><span class="op">(</span>volume <span class="op">=</span> <span class="va">vol_temp</span>,
              peatData <span class="op">=</span> <span class="va">df</span><span class="op">)</span>
<span class="co">#&gt;        5%       50%       95%      mean        sd </span>
<span class="co">#&gt; 358.35438 421.51489 484.45165 422.16075  38.01544</span></code></pre></div>
</div>
<div id="kinn-1" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Kinn 1<a class="anchor" aria-label="anchor" href="#kinn-1"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import peatland delineation</span>
<span class="va">SHP_kinn1</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"Data/Kinn/rikmyr_avgrensing.shp"</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `rikmyr_avgrensing' from data source </span>
<span class="co">#&gt;   `C:\Users\anders.kolstad\Documents\Github\carbonCalculator\Data\Kinn\rikmyr_avgrensing.shp' </span>
<span class="co">#&gt;   using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 27 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 5.099473 ymin: 61.48336 xmax: 5.102058 ymax: 61.48463</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>

<span class="co"># import peat deth data</span>
<span class="va">depths_kinn1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Data/Kinn/data_rikmyr_torvdybder.csv"</span>, 
    delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"ISO-8859-1"</span><span class="op">)</span>, 
    trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Rows: 36 Columns: 4</span>
<span class="co">#&gt; -- Column specification ------------------------------------</span>
<span class="co">#&gt; Delimiter: ";"</span>
<span class="co">#&gt; chr (2): Lokalitet, Notat</span>
<span class="co">#&gt; dbl (2): name, Dybde</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; i Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code></pre></div>
<p>The peat depth data doesn’t contain coordinated. Importing those now.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn1_spatial</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"Data/Kinn/rikmyr_punkter.shp"</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `rikmyr_punkter' from data source </span>
<span class="co">#&gt;   `C:\Users\anders.kolstad\Documents\Github\carbonCalculator\Data\Kinn\rikmyr_punkter.shp' </span>
<span class="co">#&gt;   using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 37 features and 24 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XYZ</span>
<span class="co">#&gt; Bounding box:  xmin: 5.099712 ymin: 61.48347 xmax: 5.101931 ymax: 61.48458</span>
<span class="co">#&gt; z_range:       zmin: 18.489 zmax: 44.38</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span></code></pre></div>
<p>The column <code>name</code> is shared between the two datasets so I can use this to merge them. First I need to remove leading zeros.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">Dybde</span> <span class="op">&lt;-</span> <span class="va">depths_kinn1</span><span class="op">$</span><span class="va">Dybde</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">name</span>, <span class="va">depths_kinn1</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">depths_kinn1</span><span class="op">)</span></code></pre></div>
<p>There is still one NA to remove</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn1_spatial</span> <span class="op">&lt;-</span> <span class="va">depths_kinn1_spatial</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<p>Check CRS</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#st_crs(depths_kinn1_spatial) # lat long</span>
<span class="co">#st_crs(SHP_kinn1) # also lat long</span>

<span class="va">depths_kinn1_spatial</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span>, <span class="fl">25833</span><span class="op">)</span>
<span class="va">SHP_kinn1</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">SHP_kinn1</span>, <span class="fl">25833</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_kinn1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span>,
             shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-125"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-125-1.png" alt="Test site Kinn1." width="672"><p class="caption">
Figure 7.8: Test site Kinn1.
</p>
</div>
<p>This is a nice example data set. I notice however, there are few points near the edges.</p>
<p>Getting the rough volume</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_kinn1</span><span class="op">$</span><span class="va">myArea</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">SHP_kinn1</span><span class="op">)</span>
<span class="va">SHP_kinn1</span><span class="op">$</span><span class="va">myArea</span>
<span class="co">#&gt; 13541.53 [m^2]</span></code></pre></div>
<p>Mean depth</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">Dybde</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; [1] 244.1429</span></code></pre></div>
<p>The depths are in cm. Converting to m.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">Dybde</span> <span class="op">&lt;-</span> <span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">Dybde</span><span class="op">/</span><span class="fl">100</span></code></pre></div>
<p>Number of depth measurements</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">)</span>
<span class="co">#&gt; [1] 35</span></code></pre></div>
<p>Point density (100 m-2)</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">SHP_kinn1</span><span class="op">$</span><span class="va">myArea</span> <span class="op">)</span><span class="op">*</span><span class="fl">100</span>
<span class="co">#&gt; 0.2584641 [1/m^2]</span></code></pre></div>
<p>Finding optimum power</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_optimumPower</span><span class="op">(</span>peatDepths <span class="op">=</span> <span class="va">depths_kinn1_spatial</span>,
                   peatlandDelimination <span class="op">=</span> <span class="va">SHP_kinn1</span>,
                   title <span class="op">=</span> <span class="st">"Kinn1"</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-131"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-131-1.png" alt="Finding the best power setting for the Kinn1 test site." width="672"><p class="caption">
Figure 7.9: Finding the best power setting for the Kinn1 test site.
</p>
</div>
<p>The optimal power is 5.</p>
<p>Create a raster grid for the predictions</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_kinn1_stars_crop</span> <span class="op">&lt;-</span> <span class="fu">starsExtra</span><span class="fu">::</span><span class="fu"><a href="https://michaeldorman.github.io/starsExtra/reference/make_grid.html">make_grid</a></span><span class="op">(</span><span class="va">SHP_kinn1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">SHP_kinn1</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IDW_kinn1_5</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">depths_kinn1_spatial</span>, 
                    newdata<span class="op">=</span><span class="va">grid_kinn1_stars_crop</span>, 
                    nmax<span class="op">=</span><span class="va">nmax</span>, 
                    idp<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<p>Max peat depth</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">$</span><span class="va">Dybde</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.7</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myBreaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">myPos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_kinn1_5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 5\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="va">myBreaks</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="va">myPos</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">myPos</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_kinn1_spatial</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-135"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-135-1.png" alt="Best model for test site Kinn1" width="672"><p class="caption">
Figure 7.10: Best model for test site Kinn1
</p>
</div>
<p>Predicted peat volume</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">vol_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">IDW_kinn1_5</span><span class="op">$</span><span class="va">var1.pred</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 33530.09</span></code></pre></div>
<p>Carbon stocks</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_cStocks</span><span class="op">(</span>volume <span class="op">=</span> <span class="va">vol_temp</span>,
              peatData <span class="op">=</span> <span class="va">df</span><span class="op">)</span>
<span class="co">#&gt;        5%       50%       95%      mean        sd </span>
<span class="co">#&gt; 1307.5055 1533.0524 1740.5413 1526.9631  133.1892</span></code></pre></div>
</div>
<div id="kinn2" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Kinn2<a class="anchor" aria-label="anchor" href="#kinn2"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_kinn2</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"Data/Kinn/maroy_avgrensing.shp"</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `maroy_avgrensing' from data source </span>
<span class="co">#&gt;   `C:\Users\anders.kolstad\Documents\Github\carbonCalculator\Data\Kinn\maroy_avgrensing.shp' </span>
<span class="co">#&gt;   using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 27 fields</span>
<span class="co">#&gt; Geometry type: POLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 5.102353 ymin: 61.50691 xmax: 5.107625 ymax: 61.50866</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span></code></pre></div>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Data/Kinn/data_maroy_torvdybder.csv"</span>, 
    delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"ISO-8859-1"</span><span class="op">)</span>, 
    trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Rows: 78 Columns: 4</span>
<span class="co">#&gt; -- Column specification ------------------------------------</span>
<span class="co">#&gt; Delimiter: ";"</span>
<span class="co">#&gt; chr (2): Lokalitet, Notat</span>
<span class="co">#&gt; dbl (2): name, Dybde</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; i Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; i Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></code></pre></div>
<p>As before, the depths have no coordinates.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn2_spatial</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"Data/Kinn/maroy_punkter.shp"</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `maroy_punkter' from data source </span>
<span class="co">#&gt;   `C:\Users\anders.kolstad\Documents\Github\carbonCalculator\Data\Kinn\maroy_punkter.shp' </span>
<span class="co">#&gt;   using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 78 features and 24 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XYZ</span>
<span class="co">#&gt; Bounding box:  xmin: 5.102523 ymin: 61.50698 xmax: 5.10742 ymax: 61.5086</span>
<span class="co">#&gt; z_range:       zmin: 8.484 zmax: 17.732</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>
<span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">Dybde</span> <span class="op">&lt;-</span> <span class="va">depths_kinn2</span><span class="op">$</span><span class="va">Dybde</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">name</span>, <span class="va">depths_kinn2</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">depths_kinn2</span><span class="op">)</span></code></pre></div>
<p>Transform to UTF33</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn2_spatial</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span>, <span class="fl">25833</span><span class="op">)</span>
<span class="va">SHP_kinn2</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">SHP_kinn2</span>, <span class="fl">25833</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">SHP_kinn2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span>,
             shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-143"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-143-1.png" alt="Test site Kinn2." width="672"><p class="caption">
Figure 7.11: Test site Kinn2.
</p>
</div>
<p>The mean depth</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">Dybde</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;    0.00   41.25   71.00   90.26  130.25  282.00</span></code></pre></div>
<p>Converting from cm to m</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">Dybde</span> <span class="op">&lt;-</span> <span class="va">depths_kinn2_spatial</span><span class="op">$</span><span class="va">Dybde</span><span class="op">/</span><span class="fl">100</span></code></pre></div>
<p>Area</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHP_kinn2</span><span class="op">$</span><span class="va">myArea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">SHP_kinn2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">)</span>
<span class="co">#&gt; [1] 78</span></code></pre></div>
<p>Number of peat depth measurements</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">)</span>
<span class="co">#&gt; [1] 78</span></code></pre></div>
<p>Density of points (100 m-2)</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">)</span><span class="op">/</span><span class="va">SHP_kinn2</span><span class="op">$</span><span class="va">myArea</span><span class="op">*</span><span class="fl">100</span>
<span class="co">#&gt; 0.2346467 [1/m^2]</span></code></pre></div>
<p>Find optimal power</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_optimumPower</span><span class="op">(</span>peatDepths <span class="op">=</span> <span class="va">depths_kinn2_spatial</span>,
                   peatlandDelimination <span class="op">=</span> <span class="va">SHP_kinn2</span>,
                   title <span class="op">=</span> <span class="st">"Kinn2"</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-149"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-149-1.png" alt="Finding the best power setting for the Kinn2 test site." width="672"><p class="caption">
Figure 7.12: Finding the best power setting for the Kinn2 test site.
</p>
</div>
<p>Power = 4 is best.</p>
<p>Create a raster grid for the predictions</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_kinn2_stars_crop</span> <span class="op">&lt;-</span> <span class="fu">starsExtra</span><span class="fu">::</span><span class="fu"><a href="https://michaeldorman.github.io/starsExtra/reference/make_grid.html">make_grid</a></span><span class="op">(</span><span class="va">SHP_kinn2</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">SHP_kinn2</span><span class="op">)</span></code></pre></div>
<p>Interpreted peat volume</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IDW_kinn2_4</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gstat/man/krige.html">idw</a></span><span class="op">(</span><span class="va">Dybde</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">depths_kinn2_spatial</span>, 
                    newdata<span class="op">=</span><span class="va">grid_kinn2_stars_crop</span>, 
                    nmax<span class="op">=</span><span class="va">nmax</span>, 
                    idp<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myBreaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.5</span><span class="op">)</span>
<span class="va">myPos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">IDW_kinn2_4</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"var1.pred"</span>,
            palette <span class="op">=</span> <span class="st">"-viridis"</span>,
            title <span class="op">=</span> <span class="st">"Power = 4\nInterpolated peat\ndepth (m)"</span>,
            breaks <span class="op">=</span> <span class="va">myBreaks</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, position <span class="op">=</span> <span class="va">myPos</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">myPos</span>, width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">depths_kinn2_spatial</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">4</span>,
             col<span class="op">=</span><span class="st">"black"</span>,
             size<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-152"></span>
<img src="carbonCalculator_files/figure-html/unnamed-chunk-152-1.png" alt="Best model for test site Kinn2" width="672"><p class="caption">
Figure 7.13: Best model for test site Kinn2
</p>
</div>
<p>And the volume is</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">vol_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">IDW_kinn2_4</span><span class="op">$</span><span class="va">var1.pred</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 33037.11</span></code></pre></div>
<p>And the C stock</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ccalc_cStocks</span><span class="op">(</span>volume <span class="op">=</span> <span class="va">vol_temp</span>,
              peatData <span class="op">=</span> <span class="va">df</span><span class="op">)</span>
<span class="co">#&gt;        5%       50%       95%      mean        sd </span>
<span class="co">#&gt; 1265.5436 1508.9135 1737.2036 1507.3254  140.6663</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="carbon-stocks.html"><span class="header-section-number">6</span> Carbon stocks</a></div>
<div class="next"><a href="session-info.html"><span class="header-section-number">8</span> Session Info</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#additional-test-sites"><span class="header-section-number">7</span> Additional test sites</a></li>
<li><a class="nav-link" href="#modalen"><span class="header-section-number">7.1</span> Modalen</a></li>
<li><a class="nav-link" href="#opelandsmarka"><span class="header-section-number">7.2</span> Opelandsmarka</a></li>
<li><a class="nav-link" href="#kinn-1"><span class="header-section-number">7.3</span> Kinn 1</a></li>
<li><a class="nav-link" href="#kinn2"><span class="header-section-number">7.4</span> Kinn2</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/anders-kolstad/carbonCalculator/blob/master/06-additional_test_sites.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/anders-kolstad/carbonCalculator/edit/master/06-additional_test_sites.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analyses of peatland carbon stocks</strong>" was written by Marte Fandre, Anders L. Kolstad. It was last built on 2022-12-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
